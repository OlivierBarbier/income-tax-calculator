
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculateur d'Imp√¥ts 2025</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: linear-gradient(135deg, #5B3AA0 0%, #3D2770 100%);
            min-height: 100vh;
            padding: 2rem 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .container {
            width: 100%;
            max-width: 600px;
        }

        h1 {
            text-align: center;
            color: #fff;
            font-size: 2.5rem;
            margin-bottom: 2rem;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        h1 span {
            background: linear-gradient(90deg, #FFB800, #FF6B00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .cards-grid {
            display: grid;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .card {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            overflow: hidden;
        }

        .card-header {
            background: rgba(255, 255, 255, 0.15);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .card-body {
            padding: 1.5rem;
            background: white;
        }

        .main-card-body {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            align-items: center;
        }

        .input-section {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .form-group {
            margin: 0;
        }

        label {
            display: block;
            font-size: 0.9rem;
            color: #4a5568;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        input {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 1rem;
            transition: all 0.2s;
        }

        input:focus {
            outline: none;
            border-color: #5B3AA0;
            box-shadow: 0 0 0 3px rgba(91, 58, 160, 0.1);
        }

        /* Nouveau style pour le contr√¥le des parts fiscales */
        .shares-control {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: #f8f9fa;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            padding: 0.25rem;
            transition: all 0.2s;
        }

        .shares-control:focus-within {
            border-color: #5B3AA0;
            box-shadow: 0 0 0 3px rgba(91, 58, 160, 0.1);
        }

        .shares-button {
            background: #5B3AA0;
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            user-select: none;
            -webkit-tap-highlight-color: transparent;
        }

        .shares-button:hover {
            background: #4C2D8F;
            transform: translateY(-1px);
        }

        .shares-button:active {
            transform: translateY(0);
            background: #3D2770;
        }

        .shares-button:disabled {
            background: #cbd5e0;
            cursor: not-allowed;
            transform: none;
        }

        .shares-input {
            flex: 1;
            text-align: center;
            border: none;
            background: transparent;
            font-size: 1.1rem;
            font-weight: 600;
            color: #2d3748;
            padding: 0.5rem;
        }

        .shares-input:focus {
            outline: none;
            border: none;
            box-shadow: none;
        }

        .result-section {
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .result-box {
            background: linear-gradient(135deg, #6B46C1, #5B3AA0);
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
            color: white;
            width: 100%;
            box-shadow: 0 8px 24px rgba(91, 58, 160, 0.3);
        }

        .result-amount {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .result-label {
            font-size: 0.9rem;
            letter-spacing: 0.1em;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .result-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.2);
        }

        .result-detail {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .result-detail-value {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 0.2rem;
        }

        .result-detail-label {
            font-size: 0.7rem;
            opacity: 0.8;
            letter-spacing: 0.05em;
        }

        .divider {
            width: 1px;
            background: #e2e8f0;
            height: 150px;
            margin: 0 1rem;
        }

        .bracket {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 1.25rem;
            margin-bottom: 1rem;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }

        .bracket:last-child {
            margin-bottom: 0;
        }

        .bracket.active {
            background: white;
            border-color: #5B3AA0;
            box-shadow: 0 4px 12px rgba(91, 58, 160, 0.15);
        }

        .bracket-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .bracket-range {
            font-weight: 600;
            color: #2d3748;
            font-size: 0.95rem;
        }

        .bracket-amount {
            font-weight: 700;
            font-size: 1.1rem;
            color: #2d3748;
        }

        .bracket.active .bracket-amount {
            color: #FF6B00;
        }

        .bracket-details {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
            font-size: 0.85rem;
        }

        .rate-badge {
            background: #e2e8f0;
            color: #4a5568;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.75rem;
        }

        .bracket.active .rate-badge {
            background: #22C55E;
            color: white;
        }

        .bracket-percentage {
            color: #718096;
        }

        .bracket.active .bracket-percentage {
            color: #2d3748;
            font-weight: 500;
        }

        .progress-bar {
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #22C55E, #FF6B00);
            border-radius: 4px;
            transition: width 0.5s ease;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2rem;
            }

            .main-card-body {
                grid-template-columns: 1fr;
                gap: 1.5rem;
            }

            .result-amount {
                font-size: 2rem;
            }

            .result-detail-value {
                font-size: 1rem;
            }

            .result-detail-label {
                font-size: 0.65rem;
            }

            .divider {
                display: none;
            }

            .shares-button {
                width: 44px;
                height: 44px;
                font-size: 1.3rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="cards-grid">
            <!-- Carte principale fusionn√©e -->
            <div class="card">
                <div class="card-header">
                    üí∞ Calcul de l'imp√¥t sur le revenu
                </div>
                <div class="card-body main-card-body">
                    <div class="input-section">
                        <div class="form-group">
                            <label for="income">Revenu imposable annuel (‚Ç¨)</label>
                            <input type="number" id="income" value="0" min="0" step="1000">
                        </div>
                        <div class="form-group">
                            <label for="shares">Parts fiscales</label>
                            <div class="shares-control">
                                <button type="button" class="shares-button" id="sharesDecrement">‚àí</button>
                                <input type="number" id="shares" class="shares-input" value="1" min="1" max="10" step="0.5" readonly>
                                <button type="button" class="shares-button" id="sharesIncrement">+</button>
                            </div>
                        </div>
                    </div>
                    <div class="result-section">
                        <div class="result-box">
                            <div class="result-amount" id="totalTax">0 ‚Ç¨</div>
                            <div class="result-label">Imp√¥t annuel</div>
                            <div class="result-details">
                                <div class="result-detail">
                                    <div class="result-detail-value" id="monthlyTax">0 ‚Ç¨</div>
                                    <div class="result-detail-label">Par mois</div>
                                </div>
                                <div class="result-detail">
                                    <div class="result-detail-value" id="effectiveRate">0%</div>
                                    <div class="result-detail-label">Taux effectif</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- D√©tail par tranches -->
            <div class="card">
                <div class="card-header">
                    üìä D√©tail par tranche d'imposition
                </div>
                <div class="card-body" id="brackets">
                    <!-- Les tranches seront g√©n√©r√©es dynamiquement -->
                </div>
            </div>
        </div>
    </div>

    <script>
        // Bar√®me fiscal 2024 (mis √† jour)
        const taxBrackets = [
            { rate: 0, min: 0, max: 11497, label: "0%" },
            { rate: 0.11, min: 11498, max: 29315, label: "11%" },
            { rate: 0.30, min: 29316, max: 83823, label: "30%" },
            { rate: 0.41, min: 83824, max: 180294, label: "41%" },
            { rate: 0.45, min: 180295, max: Infinity, label: "45%" }
        ];

        function formatCurrency(amount) {
            return Math.round(amount).toLocaleString('fr-FR') + ' ‚Ç¨';
        }

        function formatPercentage(percentage) {
            return percentage.toFixed(1) + '%';
        }

        function formatRange(bracket) {
            const formatNumber = (num) => Math.round(num).toLocaleString('fr-FR');
            if (bracket.max === Infinity) {
                return `Au-del√† de ${formatNumber(bracket.min)} ‚Ç¨`;
            }
            return `${formatNumber(bracket.min)} ‚Ç¨ - ${formatNumber(bracket.max)} ‚Ç¨`;
        }

        function calculateTax(income, shares) {
            if (!income || !shares || income < 0 || shares < 1) {
                return {
                    totalTax: 0,
                    quotient: 0,
                    bracketTaxes: [0, 0, 0, 0, 0],
                    monthlyTax: 0,
                    effectiveRate: 0
                };
            }

            const quotient = income / shares;
            let taxOnQuotient = 0;
            const bracketTaxes = [];

            for (const bracket of taxBrackets) {
                let bracketTax = 0;
                if (quotient > bracket.min) {
                    const taxableInBracket = Math.min(quotient, bracket.max) - bracket.min;
                    bracketTax = taxableInBracket * bracket.rate;
                }
                bracketTaxes.push(bracketTax * shares);
                taxOnQuotient += bracketTax;
            }

            const totalTax = taxOnQuotient * shares;
            const monthlyTax = totalTax / 12;
            const effectiveRate = income > 0 ? (totalTax / income) * 100 : 0;

            return {
                totalTax,
                quotient,
                bracketTaxes,
                monthlyTax,
                effectiveRate
            };
        }

        function updateResults() {
            const income = parseFloat(document.getElementById('income').value) || 0;
            const shares = parseFloat(document.getElementById('shares').value) || 1;
            
            const result = calculateTax(income, shares);
            
            if (!result) return;

            // Mise √† jour du montant total
            document.getElementById('totalTax').textContent = formatCurrency(result.totalTax);
            document.getElementById('monthlyTax').textContent = formatCurrency(result.monthlyTax);
            document.getElementById('effectiveRate').textContent = formatPercentage(result.effectiveRate);

            // Mise √† jour des tranches
            updateBrackets(result);
        }

        function updateBrackets(result) {
            const bracketsContainer = document.getElementById('brackets');
            bracketsContainer.innerHTML = '';

            const maxTax = Math.max(...result.bracketTaxes.filter(t => t > 0));

            taxBrackets.forEach((bracket, index) => {
                const bracketTax = result.bracketTaxes[index];
                const isActive = bracketTax > 0 || index === 0;
                const percentage = result.totalTax > 0 ? (bracketTax / result.totalTax) * 100 : 0;
                const progressWidth = maxTax > 0 ? (bracketTax / maxTax) * 100 : 0;

                const bracketDiv = document.createElement('div');
                bracketDiv.className = `bracket ${isActive ? 'active' : ''}`;

                bracketDiv.innerHTML = `
                    <div class="bracket-header">
                        <span class="bracket-range">${formatRange(bracket)}</span>
                        <span class="bracket-amount">${formatCurrency(bracketTax)}</span>
                    </div>
                    <div class="bracket-details">
                        <span class="rate-badge">TAUX ${bracket.label}</span>
                        <span class="bracket-percentage">
                            ${isActive ? `${percentage.toFixed(1)}% de l'imp√¥t total` : 'Non concern√©'}
                        </span>
                    </div>
                    ${isActive ? `
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progressWidth}%"></div>
                        </div>
                    ` : ''}
                `;

                bracketsContainer.appendChild(bracketDiv);
            });
        }

        // Gestion des boutons + et - pour les parts fiscales
        function updateSharesButtons() {
            const sharesInput = document.getElementById('shares');
            const decrementBtn = document.getElementById('sharesDecrement');
            const incrementBtn = document.getElementById('sharesIncrement');
            
            const currentValue = parseFloat(sharesInput.value);
            const minValue = parseFloat(sharesInput.min);
            const maxValue = parseFloat(sharesInput.max);
            
            decrementBtn.disabled = currentValue <= minValue;
            incrementBtn.disabled = currentValue >= maxValue;
        }

        function changeShares(delta) {
            const sharesInput = document.getElementById('shares');
            const currentValue = parseFloat(sharesInput.value) || 1;
            const step = 0.5;
            const minValue = parseFloat(sharesInput.min);
            const maxValue = parseFloat(sharesInput.max);
            
            const newValue = Math.max(minValue, Math.min(maxValue, currentValue + (delta * step)));
            
            sharesInput.value = newValue;
            updateSharesButtons();
            updateResults();
        }

        // √âv√©nements
        document.getElementById('income').addEventListener('input', updateResults);
        document.getElementById('shares').addEventListener('input', () => {
            updateSharesButtons();
            updateResults();
        });

        document.getElementById('sharesDecrement').addEventListener('click', () => changeShares(-1));
        document.getElementById('sharesIncrement').addEventListener('click', () => changeShares(1));

        // Pr√©vention du d√©filement sur les champs num√©riques (mobile)
        document.getElementById('shares').addEventListener('wheel', (e) => e.preventDefault());

        // Calcul initial
        updateResults();
        updateSharesButtons();
    </script>
</body>
</html>